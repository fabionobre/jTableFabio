(function(e){e.fn.jTable=function(t){function a(){e(s).html('<div class="loader"><img src="'+t.urlImageLoading+'">'+n.mensagemCarregando+"</div>");e(window).trigger("resize")}function f(i){if(n.dados!=null){json=n.dados;o=i;g(n.dados);v()}else{t.parametros["pagina"]=i;e.ajax({type:"GET",url:n.url,data:n.parametros,async:n.async,success:function(e){json=e;r=json.total;o=i;g(json.tabela);n.dados=json.tabela;v()},error:function(e,t,n){}})}}function l(t){id=".jTableCheck"+e(t).attr("rel");e(s).find(id).prop("checked",t.checked)}function c(){conteudo="";if(n.actionBar){conteudo+=p()}if(n.titleBar){conteudo+=d()}return conteudo}function h(){var e=i.length-1;if(t.editar||t.remover||t.opcoes.length>0){e++}return e}function p(){var e=t.actions;var r=h();conteudo="";conteudo+="<TR>";if(n.checkbox){conteudo+='<TH class="center" style="width:20px;">';conteudo+='<input type="checkbox" class="jTableCheckBnt" rel="'+u+'" />';conteudo+="</TH>"}conteudo+='<TH class="left last" colspan="'+(r+1)+'">';conteudo+='<ul class="jTable_action_bar">';for(var i=0;i<e.length;i++){conteudo+="<li>";if(e[i].funcao!=null){conteudo+='<a href="javascript:;" onclick="'+e[i].funcao+'();" alt="'+e[i].alt+'">'}if(e[i].icon!=null){conteudo+='<img src="'+e[i].icon+'">'}conteudo+=""+e[i].titulo+"";if(e[i].funcao!=null){conteudo+="</a>"}conteudo+="</li>"}conteudo+="</ul>";conteudo+="</TH>";return conteudo}function d(){var e=i.length-1;if(t.editar||t.remover||t.opcoes.length>0){e++}conteudo="";conteudo+="<TR>";if(n.checkbox){conteudo+='<TH class="center" style="width:20px;">';conteudo+='<input type="checkbox" class="jTableCheckBnt" rel="'+u+'" />';conteudo+="</TH>"}for(var r=0;r<i.length;r++){conteudo+='<TH class="'+i[r].align;if(r==e){conteudo+=" last"}conteudo+='" style="width:'+i[r].width+';">';conteudo+=i[r].titulo||"";conteudo+="</TH>"}if(t.opcoes.length>0){conteudo+='<TH class="center last" style="width: '+t.opcoesWidth+'">';conteudo+=t.opcoesTitulo||"opções";conteudo+="</TH>"}conteudo+="</TR>";return conteudo}function v(){json=n.dados;var a="";var h=i.length-1;if(t.editar||t.remover||t.opcoes.length>0){h++}if(json.length<=0){if(o>0){o=0;f(o)}else{a='<b class="tabelaVazia">'+n.mensagemEmpty+"</b>";e(s).html(a)}return false}a+="<TABLE>";a+=c();for(var p=0;p<json.length;p++){a+='<TR id="'+t.nome+"-"+json[p][t.campoRef]+'">';if(n.checkbox){a+='<TD class="center">';a+='<input type="checkbox" class="jTableCheck'+u+'" name="checkbox[]" value="'+p+'" />';a+="</TD>"}for(var d=0;d<i.length;d++){a+='<TD class="'+i[d].align;if(d==h){a+=" last"}a+='" style="width:'+i[d].width+';">';if(i[d].tipo==null||i[d].tipo=="monetario"){var v="";var g="";var w="";var E="";var S="";w=m(json[p],i[d].campo);if(i[d].params==null){S=w;E=i[d].campo}else{S=json[p][i[d].params];E=i[d].params}if(i[d].link!=null){v='<a href="'+i[d].link+"?"+E+"="+S+'" alt="'+i[d].alt+'"'+C+">";g="</a>"}if(i[d].link_url!=null){v='<a href="'+m(json[p],i[d].link_url)+'">';g="</a>"}if(i[d].funcao!=null&&i[d].funcao!=""){v='<a href="javascript:;" onclick="'+i[d].funcao+"('"+E+'\')" alt="'+i[d].alt+'">';g="</a>"}if(i[d].icon!=null){w='<img src="'+i[d].icon+'">'}if(i[d].tipo=="monetario"){w=b(w)}a+=v+w+g}else if(i[d].tipo=="boolean"){if(json[p][i[d].campo]=="true"||json[p][i[d].campo]==true){a+='<div class="tabelaCheck"></div>'}}a+="</TD>"}if(t.opcoes.length>0){a+='<TD class="center last" style="width: 50px">';var T="";var N="";for(x in t.opcoes){if(t.opcoes[x].ajax=="true"){N="javascript:;"}else{if(t.opcoes[x].params!=null&&t.opcoes[x].params.length>0){T="?";for(y in t.opcoes[x].params){if(y>0){T+="&"}T+=t.opcoes[x].params[y]+"="+json[p][t.opcoes[x].params[y]]}}N=t.opcoes[x].link+T}var C="";if(t.opcoes[x].target!=null){C+=' target="'+t.opcoes[x].target+'"'}if(t.opcoes[x].funcao!=null&&t.opcoes[x].funcao!=""){var k=0;C+=' onclick="'+t.opcoes[x].funcao+"(";for(y in t.opcoes[x].params){if(k>0){C+=","}C+="'"+json[p][t.opcoes[x].params[y]]+"'";k++}C+=');"'}a+='<a href="'+N+'" style="margin: 0 5px;" '+C+">";a+='<img src="'+t.opcoes[x].icon+'" alt="'+t.opcoes[x].alt+'" title="'+t.opcoes[x].alt+'">'}a+="</TD>"}if(t.editar||t.remover){a+='<TD class="center last" style="width: 50px">';if(t.editar){a+='<a href="'+t.linkEditar+"?"+t.campoRef+"="+json[p][t.campoRef]+'" style="margin-right: 10px;">';a+='<img src="'+t.iconEditar+'" alt="excluir">';a+="</a>"}if(t.remover){a+='<a href="javascript:;" onclick="'+t.funcaoRemover+"('"+json[p][t.campoRef]+"', '"+json[p][t.campoTituloRef]+"');\">";a+='<img src="'+t.iconExcluir+'" alt="excluir">';a+="</a>"}a+="</TD>"}a+="</TR>"}a+="</TABLE>";if(r>0){a+='<div class="pagination pagination-left">';a+='<ul class="pager">';if(o<=0){a+='<li class="disabled"><a href=""><< ant.</a></li>'}else{a+='<li><a href="" rel="0">inicio</a></li>';a+='<li><a href="" rel="'+(o-1)+'"><< ant.</a></li>'}var L="";if(r<=10){for(var p=0;p<r;p++){if(o==p){L=' class="current"'}else{L=""}a+="<li"+L+'><a href="" rel="'+p+'">'+(p+1)+"</a></li>"}}else{var A=0;if(o<=5){A=0}else if(parseInt(o+1)>=r){A=r-10}else{A=o-5}var O=A+10;for(var p=A;p<O;p++){if(o==p){L=' class="current"'}else{L=""}a+="<li"+L+'><a href="" rel="'+p+'">'+(p+1)+"</a></li>"}a+="<li>...</li>"}if(o>=r-1){a+='<li class="disabled"><a href="">prox. >></a></li>'}else{a+='<li><a href="" rel="'+(parseInt(o)+1)+'">prox. >></a></li>';a+='<li><a href="" rel="'+(parseInt(r)-1)+'">fim</a></li>'}a+="</ul>";a+="</div>"}e(s).html(a);e(window).trigger("resize");e(s).find(".jTableCheckBnt").click(function(){l(this)});var M=e(s).find(".pager").find("li").find("a");for(var p=0;p<M.length;p++){e(M[p]).click(function(){pagina=e(this).attr("rel");if(pagina!=""&&pagina!=null){f(pagina)}return false})}}function m(e,t){var n="";if(t.lastIndexOf(".")>0){listaCampos=t.split(".");var r=e;for(var i=0;i<listaCampos.length;i++){if(r[listaCampos[i]]!=null){r=r[listaCampos[i]]}else{r=""}}n=r}else{if(e[t]!=null){n=e[t]}}return n}function g(){if(i.length<=0&&(t.cabecalho==null||t.cabecalho.length<=0)){for(var e in json.list[0]){var n={titulo:e,align:"left",width:"auto",campo:e};i.push(n)}}else{i=t.cabecalho}}function b(e){valorProd=Math.round(e*100).toString();valorString="R$ "+valorProd.substring(0,valorProd.length-2)+","+valorProd.toString().substring(valorProd.length-2,valorProd.length);return valorString}t=e.extend({mensagem:"msg_padrao",parametros:{},opcoes:[],opcoesWidth:"80px",mensagemEmpty:"Nenhum dado encontrado",mensagemCarregando:"Carregando",async:true,checkbox:false,titleBar:true,actionBar:false,urlImageLoading:"imagens/ajax-loader.gif"},t);var n=t;var r=0;var i=[];var s=this;var o=0;var u=this.attr("id");e.fn.extend({setParametros:function(e){n=e},getParametros:function(){return n},refresh:function(e){a();if(e!=null){n.dados=e}f(o)},getSelected:function(){var n=new Array;e.each(e(s).find(".jTableCheck"+u+":checked"),function(r,i){n.push(t.dados[e(i).val()])});return n}});e(this).each(function(e){a();f(o)})}})(jQuery)